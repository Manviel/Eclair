"use strict";function _toConsumableArray(e){if(Array.isArray(e)){for(var n=0,t=Array(e.length);n<e.length;n++)t[n]=e[n];return t}return Array.from(e)}function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,n){for(var t=0;t<n.length;t++){var a=n[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(n,t,a){return t&&e(n.prototype,t),a&&e(n,a),n}}(),Charm=function(){function e(){var n=this,t=arguments.length<=0||void 0===arguments[0]?PIXI:arguments[0];if(_classCallCheck(this,e),void 0===t)throw new Error("Please assign a rendering engine in the constructor before using charm.js");this.renderer="",t.ParticleContainer&&t.Sprite&&(this.renderer="pixi"),this.globalTweens=[],this.easingFormulas={linear:function(e){return e},smoothstep:function(e){return e*e*(3-2*e)},smoothstepSquared:function(e){return Math.pow(e*e*(3-2*e),2)},smoothstepCubed:function(e){return Math.pow(e*e*(3-2*e),3)},acceleration:function(e){return e*e},accelerationCubed:function(e){return Math.pow(e*e,3)},deceleration:function(e){return 1-Math.pow(1-e,2)},decelerationCubed:function(e){return 1-Math.pow(1-e,3)},sine:function(e){return Math.sin(e*Math.PI/2)},sineSquared:function(e){return Math.pow(Math.sin(e*Math.PI/2),2)},sineCubed:function(e){return Math.pow(Math.sin(e*Math.PI/2),2)},inverseSine:function(e){return 1-Math.sin((1-e)*Math.PI/2)},inverseSineSquared:function(e){return 1-Math.pow(Math.sin((1-e)*Math.PI/2),2)},inverseSineCubed:function(e){return 1-Math.pow(Math.sin((1-e)*Math.PI/2),3)},spline:function(e,n,t,a,r){return.5*(2*t+(-n+a)*e+(2*n-5*t+4*a-r)*e*e+(-n+3*t-3*a+r)*e*e*e)},cubicBezier:function(e,n,t,a,r){var s=e*e,u=s*e;return n+(3*-n+e*(3*n-n*e))*e+(3*t+e*(-6*t+3*t*e))*e+(3*a-3*a*e)*s+r*u}},this._addScaleProperties=function(e){"pixi"===n.renderer&&(!e.scaleX&&e.scale.x&&Object.defineProperty(e,"scaleX",{get:function(){return e.scale.x},set:function(n){e.scale.x=n}}),!e.scaleY&&e.scale.y&&Object.defineProperty(e,"scaleY",{get:function(){return e.scale.y},set:function(n){e.scale.y=n}}))}}return _createClass(e,[{key:"tweenProperty",value:function(e,n,t,a,r){var s=arguments.length<=5||void 0===arguments[5]?"smoothstep":arguments[5],u=this,o=arguments.length<=6||void 0===arguments[6]?!1:arguments[6],i=arguments.length<=7||void 0===arguments[7]?0:arguments[7],g={},l=s.split(" ");return"bounce"===l[0]&&(g.startMagnitude=parseInt(l[1]),g.endMagnitude=parseInt(l[2])),g.start=function(e,n){g.startValue=JSON.parse(JSON.stringify(e)),g.endValue=JSON.parse(JSON.stringify(n)),g.playing=!0,g.totalFrames=r,g.frameCounter=0,u.globalTweens.push(g)},g.start(t,a),g.update=function(){var t=void 0;if(g.playing)if(g.frameCounter<g.totalFrames){var a=g.frameCounter/g.totalFrames;t="bounce"!==l[0]?u.easingFormulas[s](a):u.easingFormulas.spline(a,g.startMagnitude,0,1,g.endMagnitude),e[n]=g.endValue*t+g.startValue*(1-t),g.frameCounter+=1}else e[n]=g.endValue,g.end()},g.end=function(){g.playing=!1,g.onComplete&&g.onComplete(),u.globalTweens.splice(u.globalTweens.indexOf(g),1),o&&u.wait(i).then(function(){g.start(g.endValue,g.startValue)})},g.play=function(){return g.playing=!0},g.pause=function(){return g.playing=!1},g}},{key:"makeTween",value:function(e){var n=this,t={};t.tweens=[],e.forEach(function(e){var a=n.tweenProperty.apply(n,_toConsumableArray(e));t.tweens.push(a)});var a=0;return t.completed=function(){a+=1,a===t.tweens.length&&(t.onComplete&&t.onComplete(),a=0)},t.tweens.forEach(function(e){e.onComplete=function(){return t.completed()}}),t.pause=function(){t.tweens.forEach(function(e){e.playing=!1})},t.play=function(){t.tweens.forEach(function(e){e.playing=!0})},t}},{key:"fadeOut",value:function(e){var n=arguments.length<=1||void 0===arguments[1]?60:arguments[1];return this.tweenProperty(e,"alpha",e.alpha,0,n,"sine")}},{key:"fadeIn",value:function(e){var n=arguments.length<=1||void 0===arguments[1]?60:arguments[1];return this.tweenProperty(e,"alpha",e.alpha,1,n,"sine")}},{key:"pulse",value:function(e){var n=arguments.length<=1||void 0===arguments[1]?60:arguments[1],t=arguments.length<=2||void 0===arguments[2]?0:arguments[2];return this.tweenProperty(e,"alpha",e.alpha,t,n,"smoothstep",!0)}},{key:"slide",value:function(e,n,t){var a=arguments.length<=3||void 0===arguments[3]?60:arguments[3],r=arguments.length<=4||void 0===arguments[4]?"smoothstep":arguments[4],s=arguments.length<=5||void 0===arguments[5]?!1:arguments[5],u=arguments.length<=6||void 0===arguments[6]?0:arguments[6];return this.makeTween([[e,"x",e.x,n,a,r,s,u],[e,"y",e.y,t,a,r,s,u]])}},{key:"breathe",value:function(e){var n=arguments.length<=1||void 0===arguments[1]?.8:arguments[1],t=arguments.length<=2||void 0===arguments[2]?.8:arguments[2],a=arguments.length<=3||void 0===arguments[3]?60:arguments[3],r=arguments.length<=4||void 0===arguments[4]?!0:arguments[4],s=arguments.length<=5||void 0===arguments[5]?0:arguments[5];return this._addScaleProperties(e),this.makeTween([[e,"scaleX",e.scaleX,n,a,"smoothstepSquared",r,s],[e,"scaleY",e.scaleY,t,a,"smoothstepSquared",r,s]])}},{key:"scale",value:function(e){var n=arguments.length<=1||void 0===arguments[1]?.5:arguments[1],t=arguments.length<=2||void 0===arguments[2]?.5:arguments[2],a=arguments.length<=3||void 0===arguments[3]?60:arguments[3];return this._addScaleProperties(e),this.makeTween([[e,"scaleX",e.scaleX,n,a,"smoothstep",!1],[e,"scaleY",e.scaleY,t,a,"smoothstep",!1]])}},{key:"strobe",value:function(e){var n=arguments.length<=1||void 0===arguments[1]?1.3:arguments[1],t=arguments.length<=2||void 0===arguments[2]?10:arguments[2],a=arguments.length<=3||void 0===arguments[3]?20:arguments[3],r=arguments.length<=4||void 0===arguments[4]?10:arguments[4],s=arguments.length<=5||void 0===arguments[5]?!0:arguments[5],u=arguments.length<=6||void 0===arguments[6]?0:arguments[6],o="bounce "+t+" "+a;return this._addScaleProperties(e),this.makeTween([[e,"scaleX",e.scaleX,n,r,o,s,u],[e,"scaleY",e.scaleY,n,r,o,s,u]])}},{key:"wobble",value:function(e){var n=arguments.length<=1||void 0===arguments[1]?1.2:arguments[1],t=arguments.length<=2||void 0===arguments[2]?1.2:arguments[2],a=arguments.length<=3||void 0===arguments[3]?10:arguments[3],r=arguments.length<=4||void 0===arguments[4]?10:arguments[4],s=arguments.length<=5||void 0===arguments[5]?10:arguments[5],u=arguments.length<=6||void 0===arguments[6]?-10:arguments[6],o=arguments.length<=7||void 0===arguments[7]?-10:arguments[7],i=arguments.length<=8||void 0===arguments[8]?.98:arguments[8],g=this,l=arguments.length<=9||void 0===arguments[9]?!0:arguments[9],m=arguments.length<=10||void 0===arguments[10]?0:arguments[10],c="bounce "+r+" "+s,h="bounce "+u+" "+o;this._addScaleProperties(e);var f=this.makeTween([[e,"scaleX",e.scaleX,n,a,c,l,m],[e,"scaleY",e.scaleY,t,a,h,l,m]]);return f.tweens.forEach(function(e){e.onComplete=function(){e.endValue>1&&(e.endValue*=i,e.endValue<=1&&(e.endValue=1,g.removeTween(e)))}}),f}},{key:"followCurve",value:function(e,n,t){var a=arguments.length<=3||void 0===arguments[3]?"smoothstep":arguments[3],r=this,s=arguments.length<=4||void 0===arguments[4]?!1:arguments[4],u=arguments.length<=5||void 0===arguments[5]?0:arguments[5],o={},i=a.split(" ");return"bounce"===i[0]&&(o.startMagnitude=parseInt(i[1]),o.endMagnitude=parseInt(i[2])),o.start=function(e){o.playing=!0,o.totalFrames=t,o.frameCounter=0,o.pointsArray=JSON.parse(JSON.stringify(e)),r.globalTweens.push(o)},o.start(n),o.update=function(){var n=void 0,t=void 0,s=o.pointsArray;o.playing&&(o.frameCounter<o.totalFrames?(n=o.frameCounter/o.totalFrames,t="bounce"!==i[0]?r.easingFormulas[a](n):r.easingFormulas.spline(n,o.startMagnitude,0,1,o.endMagnitude),e.x=r.easingFormulas.cubicBezier(t,s[0][0],s[1][0],s[2][0],s[3][0]),e.y=r.easingFormulas.cubicBezier(t,s[0][1],s[1][1],s[2][1],s[3][1]),o.frameCounter+=1):o.end())},o.end=function(){o.playing=!1,o.onComplete&&o.onComplete(),r.globalTweens.splice(r.globalTweens.indexOf(o),1),s&&r.wait(u).then(function(){o.pointsArray=o.pointsArray.reverse(),o.start(o.pointsArray)})},o.pause=function(){o.playing=!1},o.play=function(){o.playing=!0},o}},{key:"walkPath",value:function(e,n){var t=arguments.length<=2||void 0===arguments[2]?300:arguments[2],a=arguments.length<=3||void 0===arguments[3]?"smoothstep":arguments[3],r=arguments.length<=4||void 0===arguments[4]?!1:arguments[4],s=this,u=arguments.length<=5||void 0===arguments[5]?!1:arguments[5],o=arguments.length<=6||void 0===arguments[6]?0:arguments[6],i=JSON.parse(JSON.stringify(n)),g=t/i.length,l=0,m=function h(n){var t=s.makeTween([[e,"x",i[n][0],i[n+1][0],g,a],[e,"y",i[n][1],i[n+1][1],g,a]]);return t.onComplete=function(){n+=1,n<i.length-1?s.wait(o).then(function(){t=h(n)}):r&&(u&&i.reverse(),s.wait(o).then(function(){n=0,e.x=i[0][0],e.y=i[0][1],t=h(n)}))},t},c=m(l);return c}},{key:"walkCurve",value:function(e,n){var t=arguments.length<=2||void 0===arguments[2]?300:arguments[2],a=arguments.length<=3||void 0===arguments[3]?"smoothstep":arguments[3],r=arguments.length<=4||void 0===arguments[4]?!1:arguments[4],s=this,u=arguments.length<=5||void 0===arguments[5]?!1:arguments[5],o=arguments.length<=6||void 0===arguments[6]?0:arguments[6],i=t/n.length,g=0,l=function c(t){var g=s.followCurve(e,n[t],i,a);return g.onComplete=function(){t+=1,t<n.length?s.wait(o).then(function(){g=c(t)}):r&&(u&&(n.reverse(),n.forEach(function(e){return e.reverse()})),s.wait(o).then(function(){t=0,e.x=n[0][0],e.y=n[0][1],g=c(t)}))},g},m=l(g);return m}},{key:"wait",value:function(){var e=arguments.length<=0||void 0===arguments[0]?0:arguments[0];return new Promise(function(n,t){setTimeout(n,e)})}},{key:"removeTween",value:function(e){var n=this;e.tweens?(e.pause(),e.tweens.forEach(function(e){n.globalTweens.splice(n.globalTweens.indexOf(e),1)})):(e.pause(),this.globalTweens.splice(this.globalTweens.indexOf(e),1))}},{key:"update",value:function(){if(this.globalTweens.length>0)for(var e=this.globalTweens.length-1;e>=0;e--){var n=this.globalTweens[e];n&&n.update()}}}]),e}();